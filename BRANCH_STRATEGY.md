# 晓时节后端 - Git分支策略

## 🌿 分支结构

### 主要分支

#### 1. `master` 分支 - 生产环境
- **用途**: 生产环境代码，随时可发布
- **保护**: 受保护分支，不允许直接推送
- **合并**: 只能从 `development` 分支合并
- **发布**: 每次合并到master都应该打tag
- **部署**: 自动部署到生产服务器

#### 2. `development` 分支 - 开发主分支  
- **用途**: 日常开发的主分支
- **保护**: 受保护分支，需要PR审核
- **合并**: 接收来自 `feature` 分支的合并
- **测试**: 部署到测试环境，运行自动化测试

### 辅助分支

#### 3. `feature` 分支 - 功能开发
- **命名**: `feature/功能名称` (如: `feature/user-api`)
- **用途**: 开发新的API功能
- **来源**: 从 `development` 分支创建
- **合并**: 完成后合并回 `development`
- **测试**: 需要通过单元测试和集成测试

#### 4. `hotfix` 分支 - 紧急修复
- **命名**: `hotfix/修复内容` (如: `hotfix/database-connection`)
- **用途**: 修复生产环境紧急问题
- **来源**: 从 `master` 分支创建
- **合并**: 同时合并到 `master` 和 `development`

## 🔄 工作流程

### API开发流程
1. 从 `development` 创建 `feature/api-xxx` 分支
2. 开发API接口和相关功能
3. 编写单元测试和API文档
4. 提交PR到 `development`
5. 代码审核和测试通过后合并

### 数据库变更流程
1. 在功能分支中创建数据库迁移文件
2. 更新数据模型和API
3. 测试数据库变更
4. 合并到 `development` 进行集成测试

### 发布流程
1. 在 `development` 分支完成所有功能测试
2. 运行完整的测试套件
3. 创建PR从 `development` 到 `master`
4. 审核通过后合并并打版本标签
5. 自动部署到生产环境

## 🧪 测试策略

### 分支测试要求
- **feature分支**: 单元测试覆盖率 > 80%
- **development分支**: 集成测试 + API测试
- **master分支**: 完整测试套件 + 性能测试

### 自动化测试
- PR提交时自动运行测试
- 测试失败不允许合并
- 部署前运行冒烟测试

## 📋 分支保护建议

### GitHub设置
- `master`: 
  - 启用分支保护
  - 需要PR审核 (至少1人)
  - 要求状态检查通过
  - 要求分支是最新的
  - 限制推送权限

- `development`:
  - 启用分支保护  
  - 需要PR审核
  - 要求测试通过

## 🚀 部署策略

- **development** → 测试环境 (自动部署)
- **master** → 生产环境 (手动确认后自动部署)
- **hotfix** → 紧急发布 (快速部署通道)

## 👥 团队协作

- **后端开发**: 主要在 `development` 和 `feature` 分支工作
- **DevOps**: 负责 `master` 分支的部署和监控
- **测试**: 在 `development` 分支进行API测试
- **项目经理**: 负责 `master` 分支的发布决策 